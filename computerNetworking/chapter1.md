# 第一章 计算机网络和因特网

## 因特网

什么是因特网

- 从描述因特网的具体构成，即构成因特网的基本硬件和软件组件
- 根据分布式应用提供服务的联网基础设施来描述

### 具体构成描述

- 因特网是一个世界范围的计算机网络，互联了一个遍及全世界的数以亿计的计算机网络设备，这些设备都称为**主机**或者**端系统**
- 端系统通过**通信链路**以及**分组交换机**连接在一起，一个端系统向另一个端系统发送数据时，发送端系统将数据分段，并为每段加上首部字节，由此形成的信息包称为**分组**
  - 通信链路：由不同类型的物理媒体组成，不同的链路以不同的速率进行传输
    - 物理媒体：同轴电缆，铜线，光纤，无线电频谱
    - 传输速率：比特/秒 (`bit/s`, `bps`)
  - 分组交换机：从它的一条入通信链路接收达到的分组，并从它的一个出通信链路转发该分组
    - 类型：路由器（通常用于网络核心中），链路层交换机（通常用于接入网中）
    - 路径：从发送端系统到接收端系统，一个分组所经历的一系列通信链路和分组交换机称为通过该网络的路径
  - 端系统、分组交换机和其他因特网部件都要运行一系列**协议**，这些协议控制因特网中信息的接收和发送
    - TCP(`Transmission Control Protocol `， 传输控制协议)
    - IP(`Internet Protocol`，网际协议)：定义了路由器和端系统之间发送和接收的分组格式

### 服务描述

- 从为应用程序提供服务的基础设施的角度来描述因特网
- 应用程序编程接口：规定了运行在一个端系统上的软件请求因特网基础设施向运行在另一个端系统上的特定目的地软件交付数据的方式

### 协议

在因特网中，凡是涉及两个或者多个远程通信实体的所有活动都受到协议的制约

当向`Web`服务器发出请求时(即你在`Web`浏览器中键入一个`Web`网页的`URL`)所发生的情况：

- 首先，计算机将向该`Web`服务器发送一条连接请求报文，并等待回答 
- `Web`服务器最终能接收到连接该请求报文，并返回一个连接响应报文
- 得知请求该`Web`文档正常之后，计算机则在一条`GET`报文中发送要从这台`Web`服务器上取回的网页名字
- 最后，`Web`服务器向计算机返回该`Web`网页

一个协议定义了在两个或者多个通信实体之间交换的报文的格式和次序，以及报文发送和/或接收一条报文或其他事件所采取的动作

## 网络边缘

主机 == 端系统

### 接入网

将端系统连接到其**边缘路由器**的物理链路，边缘路由器是端系统到任何其他远程端系统的路径上的第一台路由器

- 家庭接入：`DSL`、电缆、`FTTH`、拨号和卫星
- 企业（和家庭）接入：以太网和`wifi`
- 广域无线接入：`3G`和`LTE`

### 物理媒体

一个比特当从源到目的地传输时，通过一系列“传输器 - 接收器”对。对于每个传输器 - 接收器对，通过跨域一种物理媒体来传播电磁波或光脉冲来发送该比特。物理媒体划分为两类：导引型媒体和非导引型媒体

- 导引型媒体：电波沿着固定媒体前行
  - 双绞铜线
  - 同轴电缆
  - 光纤
- 非导引型媒体：电波
  - 陆地无线电信道
  - 卫星无线电信道

## 网络核心

网络核心是由互联网端系统的分组交换机和链路构成的网状网络

### 分组交换

源端系统向目的端系统发生一个报文，源将长报文划分为较小的数据块，称为分组。在源与目的之间，每个分组都通过分组通信链路和分组交换机（路由器和链路层交换机）

- 存储转发传输

  存储转发传输是指在交换机能够开始向输出链路传输该分组的第一个比特之前，必须接收到整个分组。

  一个分组通过由`N`条速率均为`R`的链路组成的路径，其端到端时延为: `d = N (L / R)`

- 排队时延和分组丢失

  每个分组交换机都有多条链路与之相连，每一个链路，分组交换机都有一个输出缓存队列，它用于存储路由器准备发往那条链路的分组。如果到达的分组需要传输到某条链路，但发现该链路正在忙于传输其他分组，就将该分组放在输出缓存队列中等待，这个即为**排队时延**。

  输出队列的缓存大小是有限的，一个到达的分组可能发现该缓存以及被其他等待的分组填充慢了，这个时候，就会将到达的分组或以及排队的分组之一丢弃，这就是**分组丢失**（丢包）

- 转发表和路由路由选择协议

  每一个路由器都有多条链路，路由器怎样决定它应该向哪条链路进行转发呢？源端系统在分组的首部包含了目的`IP`地址，路由器根据转发表将目的`IP`地址映射为输出链路

  路由转发协议：用于自动地设置转发表

### 电路交换

电路交换网络中，在端系统间通信会话期间，预留了端系统间通信沿路径所需要的资源（缓存，链路传输速率）。在分组交换网络中，这些资源是不预留的，会话的报文按需使用这些资源，可能会不得不等待（排队）接入通信线路

- 电路交换网络中的复用
  - 频分复用，链路的频谱由跨域链路创建的所有连接所共享。
  - 时分复用，时间被划分为固定区间的帧，并且每帧又被划分为固定数量的时隙。当网络跨域一条链路创建一条连接时，网络在每个帧中为该连接指定一个时隙
- 分组交换与电路交换的对比
  - 分组交换不适合实时服务，端到端时延是可变的和不可预测的 
  - 分组交换提供了比电路交换更好的带宽共享
  - 分组交换比电路交换更加的简单与高效

## 分组交换网中的时延、丢包和吞吐量

当一个分组从一个结点（主机或路由器）沿着这条路径到后继结点（主机或路由器），该分组在闫拓的每个节点经受了几种不同类型的时延

- 节点处理时延，检测分组首部和决定将该分组导向何处的时间、检查比特级别的差错所需要的时间等
- 排队时延，分组在链路上等待传输时所花费的时间，一个特定分组的排队时延长度取决于先期达到的正在排队等待向链路传输的分组数量。若队列为空，且当前没有其他分组正在传输，那么该分组的排队时延为0
- 传输时延，将所有分组的比特推（传输）向链路所需要的时间
- 传播时延，从该链路的起点到路由器传播所需要的时间即为传播时延，传播速率取决于该链路的物理媒体
- 传输时延与传播时延的比较
  - 传输时延是路由器将分组推出所需要的时间，它是分组长度和链路传输速率的函数，与两台路由器之间的距离无关
  - 传播时延是一个比特从一台路由器向另一台路由器传播所需要的时间，它是两台路由器之间距离的函数，而与分组长度或链路传输速率无关

### 排队时延与丢包

