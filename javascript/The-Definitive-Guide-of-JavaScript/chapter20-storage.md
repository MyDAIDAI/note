# 客户端存储
`web`应用允许使用浏览器`API`实现将数据存储到用户的电脑上。客户端存储遵循“同源策略”，因此不同站点的页面是无法互相读取对方存储的数据，而同一站点的不同页面之间是可以互相共享存储数据的，它为我们提供了一种通信机制，这样在一个页面上面填写的表单数据可以显示在另外一个页面中。`web`应用可以选择它们存储数据的有效期：比如采用临时存储可以让数据保存至当前窗口关闭或浏览器退出；采用永久存储，可以将数据永久地存储在硬盘上，数年或数月不失效

客户端存储有以下几种形式：
- `Web`存储：包含`localStorage`对象和`sessionStorage`对象，该存储易于使用、支持大容量数据存储同时兼容当前所有主流浏览器
- `cookie`: 只适合存储少量文本数据，并且不论服务器是否需要，每一次`HTTP`请求都会把这些数据传输到服务器
- `IE User Data`: 在`IE8`以前的`IE`浏览器中，将其作为`Web`存储的替代方案
- 离线`Web`应用: 在`HTML5`中定义了一组离线`Web`应用，用来缓存`Web`页面以及相关资源（脚本、`CSS`文件、图像）。它将`web`应用整体存储在客户端，而不仅仅是存储数据。它能够让`web`应用“安装”在客户端，这样在离线时也可以对应用进行访问
- `web`数据库: 现在有一种正在标准化的数据库`API`，称为“索引数据库`API`”。调用该`API`返回的是一个不包含查询语句的简单数据库对象
- 文件系统`API`: 该`API`可以用于操作一个私有的本地文件系统。在该文件系统中可以对文件进行读写操作

## `localStorage`和`sessionStorage`
`Window`对象上定义了两个属性：`localStorage`和`sessionStorage`。这两个属性都代表同一个`Storage`对象 -- 一个持久化的关联数组，数组使用字符串来索引，存储的值也是字符串的形式.`Storage`对象在使用上和一般的`js`对象没什么区别：设置对象的属性为字符串，浏览器就会将该值存储起来。`localStorage`与`sessionStorage`的区别在于存储的有效期和作用域不同，也就是数据的存储时间以及访问权限

`web`存储草案标准指出，既可以存储结构化的数据，也可以存储原始类型数据，还可以存储日期、正则表达式等内置类型的数据，但现在浏览器只支持存储字符串类型的数据。使用其他类型数据需要进行编码以及解码

```javascript
localStorage.x = 10
var x = parseInt(localStorage.x)

// json
localStorage.data = JSON.stringify(data)
var data = JSON.parse(localStorage.data)
```

### 存储有效期和作用域
|  | 有效期 | 作用域 |
| ------ | ------ | ------ |
| `localStorage` | 永久存储，除非手动删除 | 同源可互相访问 |
| `sessionStorage` | 窗口或标签页被关闭，数据被删除 | 同源且同一个窗口（标签页） |

需要注意的是，`sessionStorage`中一个标签页中的脚本是无法读取或者覆盖由另一个标签页脚本写入的数据，即使这两个标签页渲染的是同一个页面，运行的是同一个脚本。除此之外，`session`中的窗口作用域指的是顶级窗口，若一个标签页中包含不同的`<iframe>`，则它们的`sessionStorage`是可以共享的

### 存储`API`
|  | 设置 | 查询 | 删除 | 清除所有 | 获取长度 | 获取键名 |
| ------ | ------ | ------ | ------ | ------ | ------ | ------ |
| `localStorage` | `setItem(name, value)`方法或通过属性直接设置 | `getItem(name)`方法或通过属性直接查询 | `removeItem(name)` | `clear()` | `length` | `key(index)` | 
| `sessionStorage` | `setItem(name, value)`方法或通过属性直接设置 | `getItem(name)`方法或通过属性直接查询 | `removeItem(name)` | `clear()` | `length`| `key(index)` |

