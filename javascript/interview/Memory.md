# 关于内存

## 内存空间

在`js`中数据的存储有两种方式，一种是栈存储，一种是堆存储
- 栈数据结构，后进先出
- 堆数据结构，是一种树状结构，它存取数据的方式与书架和书非常相似，只需要找到书的名字就可以取出书籍，而不需要将其上面或者下面的书取出来
- 队列，先进先出，是事件循环的基础结构

### 变量的存放
在`js`的内存中有堆和栈，存储不同的数据类型
- 基本类型：基本类型保存在栈中，因为这些类型在内存中占用固定大小的空间，通过值访问（`Undefined`, `Null`, `Boolean`, `Number`, `String`, `Symbol`）
- 引用类型：保存在堆内存中，由于引用类型的值的大小是不固定的，因此不能将其保存在栈内存中，但是内存地址的大小是固定的，因此将内容保存在堆内存中，将引用对象**地址**保存在栈内存中。当查询引用类型的变量时，先从栈中读取内存地址，然后再通过地址找到堆中的值

在计算机的数据结构中，栈比堆的运算速度快，`Object`是一个复杂的结构并且可扩展，数组与对象都可以进行增删改查。将他们放在堆中是为了不影响栈的效率

### 思考
问题1：
```javascript
var a = 20
var b = a
b = 30
// a的值？
```
问题2：
```javascript
var a = {name: a}
var b = a
b.name = 'b'
// a.name 的值?
```
问题3：
```javascript
var a = {name: 'a'}
var b = a
a = null
// b的值
```
解答：
- 第一个的答案是 20，因为`a`的值类型是基本类型，数据传递的是副本而非引用，所有`b`的值为20, 修改`b`的值与`a`无关
- 第二个答案是 `b`, `a`中的值类型为引用类型，数据传递的是对象的引用，也就是保存在堆中的地址，所以`b`指向与`a`同一个对象，修改该对象，所有引用了这个值的变量都会发生改变
- 第三个答案是`{name: 'a'}`，开始`a`保存一个引用对象的地址并将其复制给`b`，`a`与`b`指向同一个堆中的对象，当指向`a = null`后，就是将`a`中存储的引用地址变为了`null`，不再引用堆中的地址

### 内存空间管理
`javascript`内存的生命周期
- 分配所需要的内存
- 执行代码，内存进行读写操作
- 变量使用完毕，将内存进行释放
`javascript`有自动垃圾回收机制，浏览器最常使用的是**标记清除**的算法来找到哪些变量是不再继续使用的，将`a = null`就是使`a`失去对值得引用，这个引用的值会在下一次垃圾收集器执行的时候被回收释放

对于局部作用域中的变量，当函数执行完毕，局部变量也就没有存在的必要了，所以垃圾收集器很容易判断其中的变量并将其回收。但是全局变量在什么时候需要自动释放内存空间则很难判断，所以，在开发过程中，应该避免使用全局变量

### 思考题
```javascript
var a = {n: 1}
var b = a
a.x = a = {m: 2}
// b的值?a的值
```

### 参考
[javaScript深入之内存空间详细图解](https://github.com/yygmind/blog/issues/14)