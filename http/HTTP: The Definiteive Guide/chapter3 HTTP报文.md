# HTTP 报文

## 报文流

HTTP 使用术语「流入」和「流出」来描述「事务处理」的方向。报文流入源端服务器，工作完成之后，会流回用户的 Agent 代理中

## 报文的组成部分

| 组成       | 请求报文                          | 响应报文                   |
| ---------- | --------------------------------- | -------------------------- |
| 起始行     | `GET www.baidu.com/path HTTP/1.1` | `HTTP/1.0 200 ok`          |
| 首部       | `Accept: text/*`                  | `Content-Type: text/plain` |
| 主体(可选) | （空）                            | `this is a content`        |

---

#### 请求方法

| 方法    | 描述                                               | 是否包含主体 |
| ------- | -------------------------------------------------- | ------------ |
| GET     | 从服务器获取信息                                   | 否           |
| HEAD    | 只从服务器获取信息首部                             | 否           |
| POST    | 向服务器发送需要处理的数据                         | 是           |
| PUT     | 将请求的主体部分储存在服务器上                     | 是           |
| TRACE   | 对可能经过代理服务器传送到服务器上去的报文进行追踪 | 否           |
| OPTIONS | 判断决定可以在服务器上执行哪些方法                 | 否           |
| DELETE  | 从服务器上删除一份文档                             | 否           |

注意：除了上述的方法之外，其他服务器可能还会实现一些自己的请求方法，这些附加的方法是对`HTTP`规范的扩展，因此被称为扩展方法

#### 状态码
方法是用来告诉服务器做什么事情的，状态码则用来告诉客户端发生了什么事情，可能会成功，可能无法找到所请求的资源、无资源的访问权限或者资源被移动到了其他地方等等

|整体范围|已定义范围|分类|
|----|----|----|
|100 ~ 199| 100 ~ 101| 信息提示|
|200 ~ 299| 200 ~ 206| 成功 |
|300 ~ 399| 300 ~ 305| 重定向 |
|400 ~ 499| 400 ~ 415| 客户端错误|
|500 ~ 599| 500 ~ 505| 服务器错误|

注意📢:如果收到了不认识的状态码，可能是有人将其作为当前协议的扩展定义的，只要数字以及表示含义在整体范围内即可

#### 版本号
版本号为`HTTP`应用程序提供了一种将自己所遵循的协议版本告知对方的方式

注意，版本号不会被当做**小数**来处理。版本中的每个数字（比如HTTP/1.0中的1和0）都会被当作一个单独的数字来处理。因此，在比较`HTTP`版本时，每个数字都必须单独比较，以便确定哪个版本更高。比如，`HTTP/2.22`就比`HTTP/2.3`的版本要高，因为22比3大

#### 首部
`HTTP`首部字段向请求和响应报文中添加了一些附加信息。本质上说，它们只是一些名/值对的列表。

1. 首部分类
`HTTP`规范定义了几种首部字段，*应用程序也可以随意发明自己所用的首部*

    - 通用首部：既可以出现在请求报文中，也可以出现在响应报文中
    - 请求首部：提供更多有关请求的信息
    - 响应首部：提供更多有关响应的信息
    - 实体首部：描述主体的长度和内容，或者资源自身
    - 扩展首部：规范中没有定义的新首部
2. 首部延续行
将长的首部行分为多行可以提高可读性，多出来的每行前面至少要有一个空格活制表符

#### 实体主体部分
实体的主体是HTTP报文的负荷，也就是HTTP要传输的内容。HTTP报文可以承载很多类型的数字数据: 图片、视频、HTML文档、软件应用程序等等

## 方法

#### 安全方法
HTTP定义了一组被称为安全方法的方法。`GET`方法和`HEAD`方法都被认为是安全的，这就意味着使用`GET`或`HEAD`方法的`HTTP`请求都不会产生什么动作。

#### GET
`GET`是最常用的方法。通常用于请求服务器发送某个资源
#### HEAD
`HEAD`方法与`GET`方法的行为很类似，但服务器在响应中只返回首部，不会返回实体的主体部分。这就允许客户端在未获取实际资源的情况下，对资源的首部进行检查
- 在不获取资源的情况下了解资源的类型
- 通过查看响应中的状态码，查看某个对象是否存在
- 通过查看首部，测试资源是否被修改
#### PUT
与GET从服务器读取文档相反，PUT方法会向服务器写入文档。PUT方法的语义就是让服务器用请求的主体部分来创建一个由所请求的URL命名的新文档，或者，如果那个URL已经存在的话，就用这个主体来替代
#### POST
通过实体对服务器中存储的内容进行修改
#### TRACE
客户端发起一个请求时，这个请求可能要穿过防火墙、代理、网关或其他一些应用程序。每个中间节点都可能会修改原始的HTTP请求。TRACE方法允许客户端在最终请求发送给服务器时，看看它变成什么样子

TRACE请求会在目的服务器端发起一个"环回"诊断。行程最后一站的服务器会弹回一条TRACE响应，并在响应主体中携带它收到的原始请求报文。这样客户端就可以查看在所有中间HTTP应用程序组成的请求/响应链上，原始报文是否，以及如何被毁坏或修改过

TRACE方法用于诊断，用于验证请求是否如愿穿过了请求/响应链。但它也有缺点，它对不同类型的请求（不同的方法--GET、HEAD、POST）的处理是相同的，很多HTTP应用程序会根据方法的不同做出不同的事情，但TRACE并不提供区分这些方法的机制
#### OPTIONS
OPTIONS方法请求Web服务器告知其支持的各种功能，可以询问服务器通常支持哪些方法，或者对某些特殊资源支持哪些方法
#### DELETE
DELETE方法就是请服务器删除请求URL所指定的资源。但是，客户端应用程序无法保证删除操作一定会被执行。因为HTTP规范允许服务器在不通知客户端的情况下撤销请求

#### 扩展方法
扩展方法指的就是没有在HTTP/1.1规范中定义的方法。服务器会为它所管理的资源实现一些HTTP服务，这些方法为开发者提供了一种扩展这些HTTP服务能力的手段

## 状态码
状态码为客户端提供了一种理解事务处理结果的便捷方式

#### 100 ~ 199 信息性状态码
|状态码|原因短语|含义|
|-----|-----|------|
|100|Continue|说明收到了请求的初始部分，请客户端继续。发送了这个状态码之后，服务器在收到请求之后必须进行响应|
|101|Switching Protocols|说明服务器正在根据客户端的指定，将协议切换成Update首部所列的协议|

TODO: 
1. 客户端与100 Continue
2. 服务器与100 Continue
3. 代理与100 Continue

#### 200 ~ 299 成功状态码
服务器有一组用来表示成功的状态码，分别对应于不同类型的请求

|状态码|原因短语|含义|
|-----|-----|------|
|200|OK|请求没问题，实体的主体部分包含了所请求的资源|
|201|Created|用于创建服务器对象的请求（PUT）。响应的实体主体部分中应该包含各种引用了已创建的资源的URL, Location首部包含的则是最具体的引用|
|202|Accepted|请求已被接受，但服务器还未对其执行任何动作，不能保证服务器会完成这个请求。服务器应该在实体的主体部分包含对请求状态的描述，或许还应该有对请求完成时间的预估|
|203|Non-Authoritative Information|TODO: 不太明白|
|204|No Content|响应报文中包含若干首部和一个状态行，但没有实体的主体部分。主要用于在浏览器不转为显示新文档的情况下，对其进行更新|
|205|Reset Content|负责告知浏览器清除当前页面中的所有HTML表单元素|
|206|Partial Content|成功执行了一个部分或Range请求，客户端可以通过一些特殊的首部来获取部分或某个范围内的文档，这个状态码就是说明范围请求成功。该状态码中必须包含Content-Range、Date以及ETag或Content-Location首部|

#### 300 ~ 399 重定向状态码
重定向状态码要么告知客户端使用替代位置来访问他们所感兴趣的资源，要么就提供一个替代的响应。如果资源被移动，可以发送一个重定向状态码和一个可选的`Location`首部来告知客户端资源已被移走

也可以通过某些重定向状态码（304）对资源的应用程序本地副本与源端服务器上的资源进行验证。判断是否符合条件，符合条件就发送并更新资源

|状态码|原因短语|含义|
|-----|-----|------|
|300|Multiple Choice|客户端请求一个实际指向多个资源的URL时返回改状态码|
|301|Moved Permanently|在请求的URL已被移除时使用。响应的Location首部中应该包含资源现在所处的URL。**POST请求重定向时会转为GET请求**|
|302|Found|与301状态码类似，但客户端应该使用Location首部中的URL来临时定位资源。将来的请求仍然使用老的URL。**POST请求重定向时会转为GET请求**|
|303|See Other|告知客户端应该用另一个URL来获取资源。新的URL位于响应报文的Location首部。其主要目标是允许POST请求的响应将客户端定向到某个资源上去。**POST请求重定向时会转为GET请求**|
|304|Not Modified|客户端可以通过所包含的请求资源，使其请求变成有条件的，如果资源满足条件，则发送并更新资源|
|307|Temporary Redirect|与301状态码类似，但客户端应该使用Location首部给出的URL来临时定位资源。将来的请求应该使用老的URL|

TODO: 注意：302, 303, 与307的区别

#### 400 ~ 499 客户端错误状态码
|状态码|原因短语|含义|
|-----|-----|------|
|400|Bad Request|告知客户端发送了一个错误请求|
|401|Unauthorized|未授权，请求访问权限|
|403|Forbidden|请求被服务器拒绝|
|404|Not Found|服务器无法找到所请求的URL|
|405|Method Not Allowed|请求方法不被允许|
|408|Request Timeout|请求超时|
|409|Conflict|请求资源冲突|

#### 500 ~ 599 服务器错误状态码
|状态码|原因短语|含义|
|-----|-----|------|
|500|Internal Server Error|服务器内部错误|
|501|Not Implemented|客户端发起的请求超出服务器的能力范围|
|502|Bad Gateway|作为代理或网关使用的服务器从请求响应链的下一条链路上收到了一条伪响应|
|503|Service Unavailable|服务器现在无法提供服务|
|504|Gateway Timeout|网关或代理请求超时|
|505|HTTP Version Not Supported|服务器无法支持该协议版本|

## 首部
在请求和响应报文中都可以用首部来提供信息，有些首部是某种报文专用的，有些首部则是通用的。可以将首部分为五个主要的类型
#### 通用首部
通用首部提供了与报文相关的最基本的信息

|首部|描述|
|-----|-----|
|Connection|允许客户端和服务器指定与请求/响应连接有关的选项|
|Date|提供日期和时间标志，说明报文创建时间|
|MIME-Version|发送端使用的MIME版本|
|Trailer|若报文采用了分块传输编码方式，就可以用这个首部列出位于报文拖挂部分的首部集合|
|Transfer-Encoding|告知接收端为了保证报文的可靠传输，对报文采用的编码方式|
|Update|给出了发送端可能想要"升级"使用的新版本或协议|
|Via|显示了报文经过的中间节点（代理、网关）| 

---------
|通用缓存首部|描述|
|-----|-----|
|Cache-Control|用于随报文传送缓存指示|
|Pragma|另一种随报文传送指示的方式，但并不专用于缓存|
#### 请求首部
|请求首部|描述|
|-----|-----|
|From|提供了客户端Email地址|
|Host|给出了接收请求的服务器的主机名和端口号|
|Referer|提供了包含当前请求的URI的文档的URL|
|User-Agent|将发起请求的应用程序名称告知服务器|

----
|Accept请求首部|描述|
|-----|-----|
|Accept|告知服务器能够发送哪些媒体类型|
|Accept-Charset|告知服务器能够发送哪些字符集|
|Accept-Encoding|告知服务器能够发送哪些编码方式|
|Accept-Language|告知服务器能够发送哪些语言|

-----
|条件请求首部|描述|
|-----|-----|
|Expect|允许客户端列出某请求所要求的服务器行为|
|If-Match|如果实体标记与文档当前的实体标记相匹配，就获取这份文档|
|If-Modified-Since|如果在某个指定的日期之后资源被修改过，就获取这份文档|
|If-None-Match|如果提供的实体标记与当前文档的实体标记不相符，就获取文档|
|If-Range|允许对文档的某个范围进行条件请求|
|If-Unmodified-Since|如果在某个指定的日期之后资源没有被修改过，就获取这份文档|
|Range|如果服务器支持范围请求，就请求资源的指定范围|
-----
|安全请求首部|描述|
|-----|-----|
|Authorization|包含了客户端提供给服务器，以便对自身进行认证的数据|
|Cookie|客户端用它向服务器传送一个令牌|

------
|代理请求首部|描述|
|-----|-----|
|Max-Forward|在通往源端服务器的路径上，将请求转发给其他代理或网关的最大次数|
|Proxy-Authorization|在与代理认证时使用|
|Proxy-Connection|在与代理建立连接时使用|
#### 响应首部
响应首部微客户端提供一些额外的信息

|响应协商首部|描述|
|-----|-----|
|Accept-Range|对此资源，服务器可以接受的范围类型|
|Vary|这是一个首部列表，服务器会根据这些首部的内容挑选出最适合的资源版本发送给客户端|

---------
|安全响应首部|描述|
|-----|-----|
|Proxy-Authenticate|来自代理的对客户端的质询列表|
|Set-Cookie|不是真正的安全首部，但隐含有安全功能；可以在客户端设置一个令牌，以便服务器对客户端进行标识|
|WWW-Authenticate|来自服务器的对客户端的质询列表|
#### 实体首部
实体首部提供了有关实体及其内容的大量信息，从有关对象类型的信息，到能够对资源使用的各种有效的请求方法。总之，实体首部可以告知报文的接收者它在对什么进行处理

|首部|描述|
|-----|-----|
|Allow|可以对此资源执行的请求方法|
|Location|告知客户端资源实际上位于何处，用于将接收端定向到资源的位置上去|
----
|内容首部|描述|
|-----|-----|
|Content-Encoding|对主体执行的任意编码方式|
|Content-Language|理解主体时使用的自然语言|
|Content-Length|主体的长度或尺寸|
|Content-Location|资源实际所处的位置|
|Content-MD5|主体的MD5校验和|
|Content-Range|在整个资源中此实体表示的字节范围|
|Content-Type|主体的对象类型|
----
|实体缓存首部|描述|
|-----|-----|
|Etag|与实体相关的实体标记|
|Expires|实体过期时间|
|Last-Modified|最后一次被修改的日期和时间|
#### 扩展首部
非标准的首部，由应用程序开发者创建。即使不知道这些扩展首部的含义，HTTP程序会会接受它们并对其进行转发

